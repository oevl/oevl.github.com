<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Passing MEDIA_URL in Django's 500 error view â€” Arthur Koziel</title>
    <link rel="stylesheet" href="/master2.css" type="text/css" media="screen" />
    <link rel="alternate" type="application/rss+xml" title="Atom Feed" href="/feeds/main.xml" />
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-4143429-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script');
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 
            'http://www') + '.google-analytics.com/ga.js';
        ga.setAttribute('async', 'true');
        document.documentElement.firstChild.appendChild(ga);
      })();
    </script>
</head>
<body>
    <p>
        <a href="/">Home</a> |
        <a href="/about/">About</a> | 
        <a href="/projects/">Projects</a> |
        <a href="/feeds/main.xml">RSS</a>
    </p>
    
    <h1 id="header">Passing MEDIA_URL in Django's 500 error view</h1>
    <p id="date">
        Published 15th January 2009
    </p>
    <p>The default HTTP 500 error view in Django doesn't pass the RequestContext to
templates and thus variables like MEDIA_URL will not be available. 
If, for example, your error 500 template extends your site's base template, 
the URI to the CSS style sheets won't be right.</p>
<p>Django doesn't include the RequestContext per default since in case of an HTTP
500 error it's better to 
pass less variables to lessen the chance of additional errors.
However, changing the default error 500 view in Django to pass the 
MEDIA_URL in the context is easy. </p>
<h3>Modifying the default handler</h3>
<p>We first need to write a new view which will replace the default one. The
following is identical to the default view but with the MEDIA_URL added
to the context:</p>
<div class="highlight"><pre>from django.conf import settings
from django import http
from django.template import Context, loader

def server_error(request, template_name='500.html'):
    &quot;&quot;&quot;
    500 error handler.

    Templates: `500.html`
    Context:
        MEDIA_URL
            Path of static media (e.g. &quot;media.example.org&quot;)
    &quot;&quot;&quot;
    t = loader.get_template(template_name) # You need to create a 500.html template.
    return http.HttpResponseServerError(t.render(Context({
        'MEDIA_URL': settings.MEDIA_URL
    })))</pre></div>


<p>The best place for this view is the <em>views.py</em> file in the project's root
directory.</p>
<p>To tell Django to use our view for the HTTP 500 error rather than 
the default one, we need to set the <em>handler500</em> variable in the <em>urls.py</em>
file to point to the new view:</p>
<div class="highlight"><pre>handler500 = 'projectname.views.server_error'</pre></div>


<p>And that's basically it, we've replaced the default error 500 view with our
own one that passes the MEDIA_URL in the context. </p>
<p>To see the error 500 page in action, we just need to create a url pattern
for it:</p>
<div class="highlight"><pre>if settings.DEBUG:
    urlpatterns += patterns('',
        (r'^500/$', 'projectname.views.server_error'),
    )</pre></div>
    <h2>Comments</h2>
    <div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/arthurkozielsblog/embed.js"></script><noscript><p><a href="http://disqus.com/forums/arthurkozielsblog/?url=ref">View the discussion thread.</a></p></noscript><p><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a></p>

</body>
</html>