<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>How To: Build Your Schema from Multiple Database Connections — Arthur Koziel</title>
    <link rel="stylesheet" href="/master2.css" type="text/css" media="screen" />
    <link rel="alternate" type="application/rss+xml" title="Atom Feed" href="/feeds/main.xml" />
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-4143429-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script');
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 
            'http://www') + '.google-analytics.com/ga.js';
        ga.setAttribute('async', 'true');
        document.documentElement.firstChild.appendChild(ga);
      })();
    </script>
</head>
<body>
    <p>
        <a href="/">Home</a> |
        <a href="/about/">About</a> | 
        <a href="/projects/">Projects</a> |
        <a href="/feeds/main.xml">RSS</a>
    </p>
    
    <h1 id="header">How To: Build Your Schema from Multiple Database Connections</h1>
    <p id="date">
        Published 7th January 2008
    </p>
    <p>Multiple database connections are a great feature, but if you plan to generate
a schema for each database, you will most certainly run into some problems
caused by different  connection names. This Howto will show you how to
solve the problem.</p>
<div class="section" id="connections">
<h2>Connections</h2>
<p>Let's start by defining our database connections: open up the file
<em>config/databases.yml</em> and create at least two connections with different
names (like „database” and „database1”).</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">&lt;string&gt;</tt>, line 13)</p>
<p>Unknown directive type &quot;sourcecode&quot;.</p>
<pre class="literal-block">
.. sourcecode:: text

    all:
      database:
        class:          sfPropelDatabase
        param:
          dsn:          mysql://ptest:ptest&#64;localhost/ptest

    database1:
        class:          sfPropelDatabase
        param:
          dsn:          mysql://ptest:ptest&#64;localhost/ptest2&lt;/pre&gt;

</pre>
</div>
</div>
<div class="section" id="schema">
<h2>Schema</h2>
<p>In the <em>config/propel.ini</em> configuration file, go to the the sixth line and
edit the „propel.database.url” setting so that it matches the first
database connection.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">&lt;string&gt;</tt>, line 33)</p>
<p>Unknown directive type &quot;sourcecode&quot;.</p>
<pre class="literal-block">
.. sourcecode:: text

    propel.database.url = mysql://ptest:ptest&#64;localhost/ptest

</pre>
</div>
<p>Now we can execute the <em>propel-build-schema</em> command.</p>
<p>The next little problem is that the schema generator always assumes that a
connection is named „propel” but since we've named it „database”, we need to
open the just generated schema file and rename the connection (second line).</p>
<p>Before we go on and generate the second schema, we first need to rename the
current one or otherwise symfony would just overwrite it.</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">&lt;string&gt;</tt>, line 46)</p>
<p>Unknown directive type &quot;sourcecode&quot;.</p>
<pre class="literal-block">
.. sourcecode:: bash

    mv config/schema.yml config/1_schema.yml

</pre>
</div>
<p>(<strong>Note:</strong> schema files must end with „schema.yml”)</p>
</div>
<div class="section" id="second-schema">
<h2>Second schema</h2>
<p>The procedure to generate the schema for the second connection is basically
the same as for the first one:</p>
<ol class="arabic simple">
<li>Edit the „propel.database.url” setting in <em>propel.ini</em>.</li>
<li>Execute <em>propel-build-schema</em>.</li>
<li>Open the schema and change the connection name from „propel&quot; to „database1”.</li>
<li>Rename the generated <em>schema.yml</em> to <em>2_schema.yml</em>.</li>
</ol>
<p>Finally, we can execute the <em>propel-build-model</em> command and are ready to use
our databases.</p>
</div>

    <h2>Comments</h2>
    <div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/arthurkozielsblog/embed.js"></script><noscript><p><a href="http://disqus.com/forums/arthurkozielsblog/?url=ref">View the discussion thread.</a></p></noscript><p><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a></p>

</body>
</html>